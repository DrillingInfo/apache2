# envvars - default environment variables for apache2ctl

# this won't be correct after changing uid
unset HOME

# for supporting multiple apache2 instances
if [ "${APACHE_CONFDIR##<%= @node['apache']['dir'] %>-}" != "${APACHE_CONFDIR}" ] ; then
	SUFFIX="-${APACHE_CONFDIR##<%= @node['apache']['dir'] %>-}"
else
	SUFFIX=
fi

# Since there is no sane way to get the parsed apache2 config in scripts, some
# settings are defined via environment variables and then used in apache2ctl,
# /etc/init.d/apache2, /etc/logrotate.d/apache2, etc.
export APACHE_RUN_USER=<%= @node['apache']['user'] %>
export APACHE_RUN_GROUP=<%= @node['apache']['group'] %>
export APACHE_PID_FILE=<%= @node['apache']['pid_file_base'] %>$SUFFIX.pid
export APACHE_RUN_DIR=<%= @node['apache']['run_dir'] %>$SUFFIX
export APACHE_LOCK_DIR=<%= @node['apache']['lock_dir'] %>$SUFFIX
# Only /var/log/apache2 is handled by /etc/logrotate.d/apache2.
export APACHE_LOG_DIR=<%= @node['apache']['log_dir'] %>$SUFFIX

## The locale used by some modules like mod_dav
export LANG=C
## Uncomment the following line to use the system default locale instead:
#. /etc/default/locale

export LANG

## The command to get the status for 'apache2ctl status'.
## Some packages providing 'www-browser' need '--dump' instead of '-dump'.
#export APACHE_LYNX='www-browser -dump'

## If you need a higher file descriptor limit, uncomment and adjust the
## following line (default is 8192):
#APACHE_ULIMIT_MAX_FILES='ulimit -n 65536'
<% unless @node['apache']['envvars'].empty? -%>

## Extra environment variables from node['apache']['envvars'].
<% end -%>
<% Chef::Log.debug "node['apache']['envvars'] = #{@node['apache']['envvars'].to_hash.inspect}" -%>
<% @node['apache']['envvars'].to_hash.each do |k,v| -%>
export <%= k %>=<%= v %>
<% end -%>
